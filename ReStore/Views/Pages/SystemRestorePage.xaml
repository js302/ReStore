<Page x:Class="ReStore.Views.Pages.SystemRestorePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml" mc:Ignorable="d" d:DesignHeight="600" d:DesignWidth="900" Loaded="Page_Loaded" TextOptions.TextFormattingMode="Display" TextOptions.TextRenderingMode="ClearType" Unloaded="Page_Unloaded">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="System Restore" FontSize="28" FontWeight="SemiBold" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,8"/>
            <TextBlock Text="Restore installed programs and environment variables from system backups" Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="14"/>
        </StackPanel>

        <!-- System Backups List -->
        <Border Grid.Row="1" Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="20" Effect="{StaticResource CardShadow}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- List Header -->
                <TextBlock Grid.Row="0" Text="System Backup History" FontSize="18" FontWeight="SemiBold" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,16"/>

                <!-- Tab Cards -->
                <Grid Grid.Row="1" Margin="0,0,0,16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- System Backups Tab -->
                    <Border Grid.Column="0" Background="{DynamicResource AccentFillColorDefaultBrush}" Padding="12" CornerRadius="6" Margin="0,0,6,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <StackPanel Grid.Row="0">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="📦" FontSize="18" Margin="0,0,6,0" Foreground="White"/>
                                    <TextBlock Text="System Backups" FontWeight="SemiBold" FontSize="13" Foreground="White" VerticalAlignment="Center"/>
                                </StackPanel>
                                <TextBlock x:Name="TotalBackupsText" Text="0 total" FontSize="16" FontWeight="Medium" Foreground="White" Opacity="0.9"/>
                            </StackPanel>
                            <Button Grid.Row="1" x:Name="RefreshBtn" Content="↻ Refresh" HorizontalAlignment="Center" Width="100" Cursor="Hand" Margin="0,8,0,0" Padding="8,4" FontSize="12" Background="#30FFFFFF" Foreground="White"/>
                        </Grid>
                    </Border>

                    <!-- Programs Tab -->
                    <Border Grid.Column="1" Background="#10B981" Padding="12" CornerRadius="6" Margin="6,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <StackPanel Grid.Row="0">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="💻" FontSize="18" Margin="0,0,6,0" Foreground="White"/>
                                    <TextBlock Text="Last Program Backup" FontWeight="SemiBold" FontSize="13" Foreground="White" VerticalAlignment="Center"/>
                                </StackPanel>
                                <TextBlock x:Name="LastProgramBackupText" Text="Never" FontSize="16" FontWeight="Medium" Foreground="White" Opacity="0.9" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                            <Button Grid.Row="1" x:Name="BackupProgramsBtn" Content="💾 Backup" HorizontalAlignment="Center" Width="100" Cursor="Hand" Margin="0,8,0,0" Padding="8,4" FontSize="12" Background="#30FFFFFF" Foreground="White"/>
                        </Grid>
                    </Border>

                    <!-- Environment Tab -->
                    <Border Grid.Column="2" Background="#8B5CF6" Padding="12" CornerRadius="6" Margin="6,0,0,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <StackPanel Grid.Row="0">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="⚙️" FontSize="18" Margin="0,0,6,0" Foreground="White"/>
                                    <TextBlock Text="Last Env Backup" FontWeight="SemiBold" FontSize="13" Foreground="White" VerticalAlignment="Center"/>
                                </StackPanel>
                                <TextBlock x:Name="LastEnvBackupText" Text="Never" FontSize="16" FontWeight="Medium" Foreground="White" Opacity="0.9" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                            <Button Grid.Row="1" x:Name="BackupEnvBtn" Content="💾 Backup" HorizontalAlignment="Center" Width="100" Cursor="Hand" Margin="0,8,0,0" Padding="8,4" FontSize="12" Background="#30FFFFFF" Foreground="White"/>
                        </Grid>
                    </Border>
                </Grid>

                <!-- Filter and Stats -->
                <Grid Grid.Row="2" Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" x:Name="StatsText" Text="0 backups" Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="13" VerticalAlignment="Center"/>
                    <ComboBox Grid.Column="1" x:Name="FilterTypeCombo" Width="150" SelectedIndex="0">
                        <ComboBoxItem Content="All Types" Tag="all"/>
                        <ComboBoxItem Content="Programs Only" Tag="programs"/>
                        <ComboBoxItem Content="Environment Only" Tag="environment"/>
                    </ComboBox>
                </Grid>

                <!-- Backups List -->
                <ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto">
                    <ItemsControl x:Name="SystemBackupsList">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Margin="0,0,0,12" Padding="16" Background="{DynamicResource ControlFillColorDefaultBrush}" CornerRadius="6">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Icon -->
                                        <Border Grid.Column="0" Width="48" Height="48" Background="{Binding IconColor}" CornerRadius="6" Margin="0,0,16,0">
                                            <TextBlock Text="{Binding Icon}" FontSize="24" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>

                                        <!-- Info -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding TypeLabel}" FontWeight="SemiBold" FontSize="15" Margin="0,0,0,4"/>
                                            <TextBlock Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="13">
                                                <Run Text="Created:"/>
                                                <Run Text="{Binding Timestamp, StringFormat='{}{0:MMM dd, yyyy HH:mm:ss}'}"/>
                                            </TextBlock>
                                            <TextBlock Text="{Binding Path}" Foreground="{DynamicResource TextFillColorTertiaryBrush}" FontSize="12" Margin="0,2,0,0" TextTrimming="CharacterEllipsis"/>
                                        </StackPanel>

                                        <!-- Actions -->
                                        <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                            <Button Content="View Details" Margin="0,0,8,0" Tag="{Binding}" Click="ViewDetails_Click"/>
                                            <Button Content="Restore" Margin="0,0,8,0" Tag="{Binding}" Click="RestoreBackup_Click"/>
                                            <Button Content="Delete" Margin="0,0,8,0" Tag="{Binding}" Click="DeleteBackup_Click"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- Empty State -->
                <StackPanel Grid.Row="3" x:Name="EmptyState" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Collapsed">
                    <TextBlock Text="📦" FontSize="64" HorizontalAlignment="Center" Opacity="0.3" Margin="0,0,0,16"/>
                    <TextBlock Text="No system backups found" FontSize="18" FontWeight="SemiBold" HorizontalAlignment="Center" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,8"/>
                    <TextBlock Text="Create your first system backup to get started" Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="14" HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Action Bar -->
        <Border Grid.Row="2" Margin="0,20,0,0" Padding="16" Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Effect="{StaticResource CardShadow}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorPrimaryBrush}">
                    <Run Text="💡 Tip:" FontWeight="SemiBold"/>
                    <Run Text="System backups help you quickly restore your Windows environment on a new machine." Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </TextBlock>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button x:Name="BackupFullSystemBtn" Content="Backup Full System" Margin="0,0,10,0" Cursor="Hand"/>
                    <Button x:Name="OpenBackupFolderBtn" Content="Open Backup Folder" Cursor="Hand"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Page>
