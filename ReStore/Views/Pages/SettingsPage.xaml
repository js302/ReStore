<Page x:Class="ReStore.Views.Pages.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml" Background="Transparent" TextOptions.TextFormattingMode="Display" TextOptions.TextRenderingMode="ClearType">
    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header Section -->
            <StackPanel Grid.Row="0" Margin="0,0,0,20">
                <TextBlock Text="Settings" FontSize="28" FontWeight="SemiBold" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                <TextBlock Text="Configure your backup preferences and storage providers" FontSize="13" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="0,4,0,0"/>
            </StackPanel>

            <StackPanel Grid.Row="1" Orientation="Vertical">

                <!-- Storage Providers Section -->
                <Expander IsExpanded="False" Margin="0,0,0,16">
                    <Expander.Header>
                        <Border Background="Transparent" Padding="0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock FontFamily="{StaticResource IconFont}" Text="&#xE8B7;" FontSize="18" VerticalAlignment="Center" Foreground="{DynamicResource AccentFillColorDefaultBrush}" Margin="0,0,10,0"/>
                                <TextBlock Text="Storage Providers" FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                            </StackPanel>
                        </Border>
                    </Expander.Header>
                    <Border Padding="20" Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Effect="{StaticResource CardShadow}" Margin="0,8,0,0">
                        <StackPanel Orientation="Vertical">
                            <Grid Margin="0,0,0,12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="140"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Default storage" VerticalAlignment="Center" FontSize="14" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                                <ComboBox x:Name="StorageCombo" Grid.Column="1" MinWidth="300" HorizontalAlignment="Left">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding}"/>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                            </Grid>

                            <CheckBox x:Name="ShowConfiguredOnly" Content="Show only configured providers" Margin="0,0,0,16"/>

                            <Button x:Name="OpenConfigBtn" Content="ðŸ“‚ Open Config Location" Cursor="Hand" HorizontalAlignment="Left"/>

                            <Rectangle Height="1" Fill="{DynamicResource DividerStrokeColorDefaultBrush}" Opacity="0.3" Margin="0,20,0,16"/>

                            <!-- Providers -->
                            <TextBlock Text="Configure Providers" FontSize="14" FontWeight="Medium" Margin="0,0,0,12" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>

                            <Expander Header="Local Storage" Margin="0,0,0,12" IsExpanded="False">
                                <StackPanel Margin="12,12,12,8">
                                    <Grid Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Path" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                                        <TextBox x:Name="LocalPathBox" Grid.Column="1"/>
                                    </Grid>
                                    <StackPanel Orientation="Horizontal">
                                        <Button x:Name="SaveLocalBtn" Content="ðŸ’¾ Save" Cursor="Hand"/>
                                        <Button x:Name="TestLocalBtn" Content="ðŸ”„ Test Connection" Margin="8,0,0,0" Cursor="Hand"/>
                                    </StackPanel>
                                </StackPanel>
                            </Expander>

                            <Expander Header="Amazon S3" Margin="0,0,0,12" IsExpanded="False">
                                <StackPanel Margin="12,12,12,8">
                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBlock Text="Access Key" Grid.Row="0" VerticalAlignment="Center" Margin="0,0,0,8"/>
                                        <TextBox x:Name="S3AccessKey" Grid.Row="0" Grid.Column="1" Margin="0,0,0,8"/>

                                        <TextBlock Text="Secret Key" Grid.Row="1" VerticalAlignment="Center" Margin="0,0,0,8"/>
                                        <PasswordBox x:Name="S3SecretKey" Grid.Row="1" Grid.Column="1" Margin="0,0,0,8"/>

                                        <TextBlock Text="Region" Grid.Row="2" VerticalAlignment="Center" Margin="0,0,0,8"/>
                                        <TextBox x:Name="S3Region" Grid.Row="2" Grid.Column="1" Margin="0,0,0,8"/>

                                        <TextBlock Text="Bucket" Grid.Row="3" VerticalAlignment="Center" Margin="0,0,0,12"/>
                                        <TextBox x:Name="S3Bucket" Grid.Row="3" Grid.Column="1" Margin="0,0,0,12"/>
                                    </Grid>
                                    <StackPanel Orientation="Horizontal">
                                        <Button x:Name="SaveS3Btn" Content="ðŸ’¾ Save" Cursor="Hand"/>
                                        <Button x:Name="TestS3Btn" Content="ðŸ”„ Test Connection" Margin="8,0,0,0" Cursor="Hand"/>
                                    </StackPanel>
                                </StackPanel>
                            </Expander>

                            <Expander Header="Google Drive" Margin="0,0,0,12" IsExpanded="False">
                                <StackPanel Margin="12,12,12,8">
                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBlock Text="Client ID" Grid.Row="0" VerticalAlignment="Center" Margin="0,0,0,8"/>
                                        <TextBox x:Name="GDClientId" Grid.Row="0" Grid.Column="1" Margin="0,0,0,8"/>

                                        <TextBlock Text="Client Secret" Grid.Row="1" VerticalAlignment="Center" Margin="0,0,0,8"/>
                                        <PasswordBox x:Name="GDClientSecret" Grid.Row="1" Grid.Column="1" Margin="0,0,0,8"/>

                                        <TextBlock Text="Token Folder" Grid.Row="2" VerticalAlignment="Center" Margin="0,0,0,8"/>
                                        <TextBox x:Name="GDTokenFolder" Grid.Row="2" Grid.Column="1" Margin="0,0,0,8"/>

                                        <TextBlock Text="Backup Folder" Grid.Row="3" VerticalAlignment="Center" Margin="0,0,0,12"/>
                                        <TextBox x:Name="GDBackupFolder" Grid.Row="3" Grid.Column="1" Margin="0,0,0,12"/>
                                    </Grid>
                                    <StackPanel Orientation="Horizontal">
                                        <Button x:Name="SaveGDriveBtn" Content="ðŸ’¾ Save" Cursor="Hand"/>
                                        <Button x:Name="TestGDriveBtn" Content="ðŸ”„ Test Connection" Margin="8,0,0,0" Cursor="Hand"/>
                                    </StackPanel>
                                </StackPanel>
                            </Expander>

                            <Expander Header="GitHub" Margin="0,0,0,12" IsExpanded="False">
                                <StackPanel Margin="12,12,12,8">
                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBlock Text="Token" Grid.Row="0" VerticalAlignment="Center" Margin="0,0,0,8"/>
                                        <PasswordBox x:Name="GhToken" Grid.Row="0" Grid.Column="1" Margin="0,0,0,8"/>

                                        <TextBlock Text="Owner" Grid.Row="1" VerticalAlignment="Center" Margin="0,0,0,8"/>
                                        <TextBox x:Name="GhOwner" Grid.Row="1" Grid.Column="1" Margin="0,0,0,8"/>

                                        <TextBlock Text="Repo" Grid.Row="2" VerticalAlignment="Center" Margin="0,0,0,12"/>
                                        <TextBox x:Name="GhRepo" Grid.Row="2" Grid.Column="1" Margin="0,0,0,12"/>
                                    </Grid>
                                    <StackPanel Orientation="Horizontal">
                                        <Button x:Name="SaveGitHubBtn" Content="ðŸ’¾ Save" Cursor="Hand"/>
                                        <Button x:Name="TestGitHubBtn" Content="ðŸ”„ Test Connection" Margin="8,0,0,0" Cursor="Hand"/>
                                    </StackPanel>
                                </StackPanel>
                            </Expander>
                        </StackPanel>
                    </Border>
                </Expander>

                <!-- Watch Directories Section -->
                <Expander IsExpanded="False" Margin="0,0,0,16">
                    <Expander.Header>
                        <Border Background="Transparent" Padding="0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock FontFamily="{StaticResource IconFont}" Text="&#xE8B7;" FontSize="18" VerticalAlignment="Center" Foreground="{DynamicResource AccentFillColorDefaultBrush}" Margin="0,0,10,0"/>
                                <TextBlock Text="Watched Directories &amp; Storage" FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                            </StackPanel>
                        </Border>
                    </Expander.Header>
                    <Border Padding="20" Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Effect="{StaticResource CardShadow}" Margin="0,8,0,0">
                        <StackPanel Orientation="Vertical">
                            <TextBlock Text="Configure directories to monitor and their backup storage destinations." Margin="0,0,0,12" TextWrapping="Wrap" Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="12"/>

                            <!-- Global Storage Setting -->
                            <Border Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}" CornerRadius="6" Padding="12" Margin="0,0,0,12">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="ðŸŒ Global Default Storage:" FontSize="13" FontWeight="SemiBold" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,12,0"/>
                                    <ComboBox x:Name="GlobalStorageCombo" Grid.Column="1" MinWidth="150" HorizontalAlignment="Left" VerticalAlignment="Center" SelectionChanged="GlobalStorageCombo_SelectionChanged"/>
                                    <TextBlock Grid.Column="2" Text="(applies to paths without specific storage)" FontSize="11" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="12,0,0,0"/>
                                </Grid>
                            </Border>

                            <Border Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}" CornerRadius="6" Padding="12" MaxHeight="300" Margin="0,0,0,12">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <ItemsControl x:Name="WatchDirectoriesList" Padding="0,0,8,0">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="4" Padding="10" Margin="0,0,0,6">
                                                    <Grid>
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition Height="Auto"/>
                                                        </Grid.RowDefinitions>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>

                                                        <!-- Directory Path Row -->
                                                        <TextBlock Grid.Row="0" Grid.Column="0" FontFamily="{StaticResource IconFont}" Text="&#xE8B7;" FontSize="14" VerticalAlignment="Center" Foreground="{DynamicResource AccentFillColorDefaultBrush}" Margin="0,0,8,0"/>
                                                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding Path}" FontSize="12" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorPrimaryBrush}" TextTrimming="CharacterEllipsis" Margin="0,0,8,0"/>
                                                        <Button Grid.Row="0" Grid.Column="2" Content="âœ•" FontSize="12" Padding="6,2" Tag="{Binding Path}" Click="RemoveWatchDir_Click" Cursor="Hand" ToolTip="Remove"/>

                                                        <!-- Storage Selection Row -->
                                                        <Grid Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" Margin="22,6,0,0">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto"/>
                                                                <ColumnDefinition Width="*"/>
                                                            </Grid.ColumnDefinitions>
                                                            <TextBlock Grid.Column="0" Text="Storage:" FontSize="11" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="0,0,8,0"/>
                                                            <ComboBox Grid.Column="1" x:Name="PathStorageCombo" MinWidth="120" HorizontalAlignment="Left" FontSize="11" Tag="{Binding}" SelectionChanged="PathStorageCombo_SelectionChanged" Loaded="PathStorageCombo_Loaded">
                                                                <ComboBoxItem Content="Use Global Default" Tag=""/>
                                                                <ComboBoxItem Content="Local" Tag="local"/>
                                                                <ComboBoxItem Content="Amazon S3" Tag="s3"/>
                                                                <ComboBoxItem Content="Google Drive" Tag="gdrive"/>
                                                                <ComboBoxItem Content="GitHub" Tag="github"/>
                                                            </ComboBox>
                                                        </Grid>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </Border>

                            <StackPanel Orientation="Horizontal">
                                <Button x:Name="AddWatchDirBtn" Content="âž• Add Directory" Cursor="Hand" Margin="0,0,8,0"/>
                                <Button x:Name="ApplyStorageToAllBtn" Content="ðŸ“‹ Apply Current Global Storage to All Paths" Cursor="Hand" Click="ApplyStorageToAll_Click"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Expander>

                <!-- Backup Configuration Section -->
                <Expander IsExpanded="False" Margin="0,0,0,16">
                    <Expander.Header>
                        <Border Background="Transparent" Padding="0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock FontFamily="{StaticResource IconFont}" Text="&#xE8C8;" FontSize="18" VerticalAlignment="Center" Foreground="{DynamicResource AccentFillColorDefaultBrush}" Margin="0,0,10,0"/>
                                <TextBlock Text="Backup Configuration" FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                            </StackPanel>
                        </Border>
                    </Expander.Header>
                    <Border Padding="20" Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Effect="{StaticResource CardShadow}" Margin="0,8,0,0">
                        <StackPanel Orientation="Vertical">

                            <Grid Margin="0,0,0,12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="160"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Text="Backup Type" VerticalAlignment="Center" FontSize="14" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,12"/>
                                <ComboBox x:Name="BackupTypeCombo" Grid.Row="0" Grid.Column="1" MinWidth="200" HorizontalAlignment="Left" Margin="0,0,0,12">
                                    <ComboBoxItem Content="Full" Tag="Full"/>
                                    <ComboBoxItem Content="Incremental" Tag="Incremental"/>
                                    <ComboBoxItem Content="Differential" Tag="Differential"/>
                                </ComboBox>

                                <TextBlock Grid.Row="1" Text="Backup Interval" VerticalAlignment="Center" FontSize="14" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,12"/>
                                <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Margin="0,0,0,12">
                                    <TextBox x:Name="BackupIntervalHoursBox" Width="60" HorizontalAlignment="Left"/>
                                    <TextBlock Text="hours" VerticalAlignment="Center" Margin="8,0,0,0" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                </StackPanel>

                                <TextBlock Grid.Row="2" Text="Size Threshold" VerticalAlignment="Center" FontSize="14" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,12"/>
                                <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" Margin="0,0,0,12">
                                    <TextBox x:Name="SizeThresholdBox" Width="80" HorizontalAlignment="Left"/>
                                    <TextBlock Text="MB" VerticalAlignment="Center" Margin="8,0,0,0" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                </StackPanel>

                                <TextBlock Grid.Row="3" Text="Max File Size" VerticalAlignment="Center" FontSize="14" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,12"/>
                                <StackPanel Grid.Row="3" Grid.Column="1" Orientation="Horizontal" Margin="0,0,0,12">
                                    <TextBox x:Name="MaxFileSizeBox" Width="80" HorizontalAlignment="Left"/>
                                    <TextBlock Text="MB" VerticalAlignment="Center" Margin="8,0,0,0" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                </StackPanel>
                            </Grid>

                            <TextBlock Text="Backup Type:" FontWeight="SemiBold" FontSize="12" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,4"/>
                            <TextBlock Text="â€¢ Full: Backs up all files every time" FontSize="11" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="0,0,0,2"/>
                            <TextBlock Text="â€¢ Incremental: Backs up only files changed since last backup" FontSize="11" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="0,0,0,2"/>
                            <TextBlock Text="â€¢ Differential: Backs up files changed since last full backup" FontSize="11" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="0,0,0,12"/>

                            <Button x:Name="SaveBackupConfigBtn" Content="ðŸ’¾ Save Backup Configuration" Cursor="Hand" HorizontalAlignment="Left"/>
                        </StackPanel>
                    </Border>
                </Expander>

                <!-- Encryption Section -->
                <Expander IsExpanded="False" Margin="0,0,0,16">
                    <Expander.Header>
                        <Border Background="Transparent" Padding="0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock FontFamily="{StaticResource IconFont}" Text="&#xE72E;" FontSize="18" VerticalAlignment="Center" Foreground="{DynamicResource AccentFillColorDefaultBrush}" Margin="0,0,10,0"/>
                                <TextBlock Text="Encryption" FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                            </StackPanel>
                        </Border>
                    </Expander.Header>
                    <Border Padding="20" Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Effect="{StaticResource CardShadow}" Margin="0,8,0,0">
                        <StackPanel Orientation="Vertical">
                            <TextBlock Text="Configure backup encryption to secure your data with AES-256 encryption." Margin="0,0,0,16" TextWrapping="Wrap" Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="11"/>

                            <!-- Encryption Status -->
                            <Grid Margin="0,0,0,16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Status:" FontSize="14" FontWeight="SemiBold" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,12,0"/>
                                <TextBlock x:Name="EncryptionStatusText" Grid.Column="1" Text="Disabled" FontSize="14" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                            </Grid>

                            <!-- Enable/Disable Button -->
                            <ui:Button x:Name="ToggleEncryptionBtn" Content="Enable Encryption" Appearance="Primary" Click="ToggleEncryption_Click" HorizontalAlignment="Left" Margin="0,0,0,16"/>

                            <!-- Security Warning -->
                            <Border Background="{DynamicResource SystemFillColorCautionBackgroundBrush}" CornerRadius="6" Padding="12" Margin="0,0,0,16">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock FontFamily="{StaticResource IconFont}" Text="&#xE7BA;" FontSize="16" VerticalAlignment="Top" Foreground="{DynamicResource SystemFillColorCautionBrush}" Margin="0,0,12,0"/>
                                    <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{DynamicResource TextFillColorPrimaryBrush}">
                                        <Run FontWeight="Bold" Text="Important:"/>
                                        <Run Text="Store your encryption password securely. If you lose the password, your backups cannot be recovered."/>
                                    </TextBlock>
                                </StackPanel>
                            </Border>

                            <!-- Encryption Details -->
                            <Expander x:Name="EncryptionDetailsExpander" Header="Details" IsExpanded="False" Margin="0,0,0,16">
                                <Border Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}" CornerRadius="6" Padding="12" Margin="0,8,0,0">
                                    <StackPanel>
                                        <TextBlock Text="â€¢ Algorithm: AES-256-GCM" FontSize="11" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="0,0,0,4"/>
                                        <TextBlock Text="â€¢ Key Derivation: PBKDF2-SHA256 (100,000 iterations)" FontSize="11" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="0,0,0,4"/>
                                        <TextBlock Text="â€¢ Each backup uses a unique encryption key" FontSize="11" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="0,0,0,4"/>
                                        <TextBlock Text="â€¢ Authenticated encryption prevents tampering" FontSize="11" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                    </StackPanel>
                                </Border>
                            </Expander>

                            <!-- How It Works -->
                            <Border Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}" CornerRadius="6" Padding="12">
                                <StackPanel>
                                    <TextBlock Text="How It Works" FontSize="13" FontWeight="SemiBold" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,8"/>
                                    <TextBlock Text="1. When enabled, you'll set a master password" FontSize="11" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="0,0,0,4"/>
                                    <TextBlock Text="2. Each backup is encrypted with a unique key derived from your password" FontSize="11" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="0,0,0,4"/>
                                    <TextBlock Text="3. When restoring, you'll be prompted for your password" FontSize="11" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="0,0,0,4"/>
                                    <TextBlock Text="4. Encrypted backups are stored with .enc extension" FontSize="11" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Border>
                </Expander>

                <!-- System Backup Section -->
                <Expander IsExpanded="False" Margin="0,0,0,16">
                    <Expander.Header>
                        <Border Background="Transparent" Padding="0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock FontFamily="{StaticResource IconFont}" Text="&#xE7F8;" FontSize="18" VerticalAlignment="Center" Foreground="{DynamicResource AccentFillColorDefaultBrush}" Margin="0,0,10,0"/>
                                <TextBlock Text="System Backup" FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                            </StackPanel>
                        </Border>
                    </Expander.Header>
                    <Border Padding="20" Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Effect="{StaticResource CardShadow}" Margin="0,8,0,0">
                        <StackPanel Orientation="Vertical">
                            <TextBlock Text="Configure automatic backup of system state (installed programs and environment variables)" Margin="0,0,0,16" TextWrapping="Wrap" Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="11"/>

                            <Grid Margin="0,0,0,12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="200"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Text="Enable System Backup" VerticalAlignment="Center" FontSize="14" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,12"/>
                                <CheckBox x:Name="SystemBackupEnabledCheckBox" Grid.Row="0" Grid.Column="1" Margin="0,0,0,12"/>

                                <TextBlock Grid.Row="1" Text="Include Programs" VerticalAlignment="Center" FontSize="14" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,12"/>
                                <CheckBox x:Name="SystemBackupIncludeProgramsCheckBox" Grid.Row="1" Grid.Column="1" Margin="0,0,0,12"/>

                                <TextBlock Grid.Row="2" Text="Include Environment Variables" VerticalAlignment="Center" FontSize="14" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,12"/>
                                <CheckBox x:Name="SystemBackupIncludeEnvCheckBox" Grid.Row="2" Grid.Column="1" Margin="0,0,0,12"/>

                                <TextBlock Grid.Row="3" Text="System Backup Interval" VerticalAlignment="Center" FontSize="14" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,12"/>
                                <StackPanel Grid.Row="3" Grid.Column="1" Orientation="Horizontal" Margin="0,0,0,12">
                                    <TextBox x:Name="SystemBackupIntervalHoursBox" Width="60" HorizontalAlignment="Left"/>
                                    <TextBlock Text="hours" VerticalAlignment="Center" Margin="8,0,0,0" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                </StackPanel>
                            </Grid>

                            <TextBlock Text="Exclude System Programs (regex patterns)" FontSize="13" FontWeight="Medium" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,8,0,8"/>
                            <TextBlock Text="Patterns to exclude certain system programs from backup (e.g., Microsoft Visual C++, KB[0-9]+)" Margin="0,0,0,8" TextWrapping="Wrap" Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="11"/>

                            <Border Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}" CornerRadius="6" Padding="12" MaxHeight="150" Margin="0,0,0,12">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <ItemsControl x:Name="ExcludeSystemProgramsList" Padding="0,0,8,0">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="4" Padding="6" Margin="0,0,0,4">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0" Text="{Binding}" FontSize="11" FontFamily="Consolas" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                                                        <Button Grid.Column="1" Content="âœ•" FontSize="10" Padding="4,2" Tag="{Binding}" Click="RemoveSystemProgram_Click" Cursor="Hand" ToolTip="Remove"/>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </Border>

                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                <TextBox x:Name="NewSystemProgramPatternBox" Width="250" ToolTip="e.g., Microsoft Visual C++, KB[0-9]+"/>
                                <Button x:Name="AddSystemProgramBtn" Content="âž• Add" Margin="8,0,0,0" Cursor="Hand"/>
                            </StackPanel>

                            <Button x:Name="SaveSystemBackupConfigBtn" Content="ðŸ’¾ Save System Backup Configuration" Cursor="Hand" HorizontalAlignment="Left"/>
                        </StackPanel>
                    </Border>
                </Expander>

                <!-- Exclusions Section -->
                <Expander IsExpanded="False" Margin="0,0,0,16">
                    <Expander.Header>
                        <Border Background="Transparent" Padding="0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock FontFamily="{StaticResource IconFont}" Text="&#xE8E8;" FontSize="18" VerticalAlignment="Center" Foreground="{DynamicResource AccentFillColorDefaultBrush}" Margin="0,0,10,0"/>
                                <TextBlock Text="Exclusions" FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                            </StackPanel>
                        </Border>
                    </Expander.Header>
                    <Border Padding="20" Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Effect="{StaticResource CardShadow}" Margin="0,8,0,0">
                        <StackPanel Orientation="Vertical">

                            <TextBlock Text="Excluded File Patterns" FontSize="13" FontWeight="Medium" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,8"/>
                            <TextBlock Text="File patterns to exclude from backups (e.g., *.tmp, *.log)" Margin="0,0,0,8" TextWrapping="Wrap" Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="11"/>

                            <Border Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}" CornerRadius="6" Padding="12" MaxHeight="150" Margin="0,0,0,12">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <ItemsControl x:Name="ExcludedPatternsList" Padding="0,0,8,0">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="4" Padding="6" Margin="0,0,0,4">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0" Text="{Binding}" FontSize="11" FontFamily="Consolas" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                                                        <Button Grid.Column="1" Content="âœ•" FontSize="10" Padding="4,2" Tag="{Binding}" Click="RemovePattern_Click" Cursor="Hand" ToolTip="Remove"/>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </Border>

                            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                                <TextBox x:Name="NewPatternBox" Width="200" ToolTip="e.g., *.tmp, *.log"/>
                                <Button x:Name="AddPatternBtn" Content="âž• Add" Margin="8,0,0,0" Cursor="Hand"/>
                            </StackPanel>

                            <TextBlock Text="Excluded Paths" FontSize="13" FontWeight="Medium" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,8"/>
                            <TextBlock Text="Full paths to exclude from backups (e.g., C:\Temp)" Margin="0,0,0,8" TextWrapping="Wrap" Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="11"/>

                            <Border Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}" CornerRadius="6" Padding="12" MaxHeight="150" Margin="0,0,0,12">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <ItemsControl x:Name="ExcludedPathsList" Padding="0,0,8,0">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="4" Padding="6" Margin="0,0,0,4">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0" Text="{Binding}" FontSize="11" FontFamily="Consolas" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorPrimaryBrush}" TextTrimming="CharacterEllipsis"/>
                                                        <Button Grid.Column="1" Content="âœ•" FontSize="10" Padding="4,2" Tag="{Binding}" Click="RemovePath_Click" Cursor="Hand" ToolTip="Remove"/>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </Border>

                            <StackPanel Orientation="Horizontal">
                                <Button x:Name="AddPathBtn" Content="âž• Add Path" Cursor="Hand"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Expander>

                <!-- Application Behavior Section -->
                <Expander IsExpanded="False" Margin="0,0,0,16">
                    <Expander.Header>
                        <Border Background="Transparent" Padding="0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock FontFamily="{StaticResource IconFont}" Text="&#xE7C1;" FontSize="18" VerticalAlignment="Center" Foreground="{DynamicResource AccentFillColorDefaultBrush}" Margin="0,0,10,0"/>
                                <TextBlock Text="Application Behavior" FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                            </StackPanel>
                        </Border>
                    </Expander.Header>
                    <Border Padding="20" Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Effect="{StaticResource CardShadow}" Margin="0,8,0,0">
                        <StackPanel Orientation="Vertical">
                            <CheckBox x:Name="RunAtStartupCheckBox" Content="Run at Windows startup" Margin="0,0,0,12"/>
                            <TextBlock Text="When enabled, ReStore will automatically start when you log in to Windows." Margin="0,4,0,16" TextWrapping="Wrap" Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="12" LineHeight="18"/>

                            <CheckBox x:Name="MinimizeToTrayCheckBox" Content="Minimize to system tray on close" Margin="0,0,0,8"/>
                            <TextBlock Text="When enabled, closing the window will minimize the app to the system tray instead of exiting. Double-click the tray icon to restore or right-click for options." Margin="0,4,0,16" TextWrapping="Wrap" Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="12" LineHeight="18"/>

                            <Rectangle Height="1" Fill="{DynamicResource DividerStrokeColorDefaultBrush}" Opacity="0.3" Margin="0,4,0,16"/>

                            <StackPanel Margin="0,0,0,12">
                                <TextBlock Text="Command Line Interface (CLI)" FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Margin="0,0,0,4"/>
                                <TextBlock Text="The 'restore' command is automatically available in all terminals after installation." FontSize="12" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="0,0,0,8" TextWrapping="Wrap"/>
                                <TextBlock Text="Usage examples: restore backup &lt;directory&gt;, restore list, restore --help" Margin="0,0,0,8" TextWrapping="Wrap" Foreground="{DynamicResource TextFillColorTertiaryBrush}" FontSize="12" LineHeight="18"/>
                                <TextBlock FontSize="12" Foreground="{DynamicResource TextFillColorSecondaryBrush}" TextWrapping="Wrap" LineHeight="16">
                                    <Run Text="To disable: Settings â†’ Apps â†’ Advanced app settings â†’ App execution aliases â†’ Toggle 'restore.exe' off" FontStyle="Italic"/>
                                </TextBlock>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Expander>

                <!-- Appearance & Behavior Section -->
                <Expander IsExpanded="False" Margin="0,0,0,16">
                    <Expander.Header>
                        <Border Background="Transparent" Padding="0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock FontFamily="{StaticResource IconFont}" Text="&#xE790;" FontSize="18" VerticalAlignment="Center" Foreground="{DynamicResource AccentFillColorDefaultBrush}" Margin="0,0,10,0"/>
                                <TextBlock Text="Appearance" FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                            </StackPanel>
                        </Border>
                    </Expander.Header>
                    <Border Padding="20" Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Effect="{StaticResource CardShadow}" Margin="0,8,0,0">
                        <StackPanel Orientation="Vertical">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="140"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Theme" VerticalAlignment="Center" FontSize="14" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                                <ComboBox x:Name="ThemeSelector" Grid.Column="1" MinWidth="200" HorizontalAlignment="Left">
                                    <ComboBoxItem Content="System"/>
                                    <ComboBoxItem Content="Light"/>
                                    <ComboBoxItem Content="Dark"/>
                                </ComboBox>
                            </Grid>
                        </StackPanel>
                    </Border>
                </Expander>

            </StackPanel>
        </Grid>
    </ScrollViewer>
</Page>